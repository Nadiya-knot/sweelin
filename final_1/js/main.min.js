var a="active",cardActive=0,sugarActive=0,sectionActive=0,sweelinActive=0,sweelinActiveStop=0,back=0,card=0,load=0,block=$("<div>").css({height:"50px",width:"50px"}),indicator=$("<div>").css({height:"200px"});$("body").append(block.append(indicator));var w1=$("div",block).innerWidth();block.css("overflow-y","scroll");var w2=$("div",block).innerWidth();$(block).remove();var scrollbar=w1-w2;function knotLoad(){knotLax(),vending("#vending"),sliderStart(),cursorHover("._btn"),$(document).on("mousemove",(function(e){$("#cursor").show(),cursorPosition(e.pageX,e.pageY)})),$(document).on("scroll",(function(){$("#cursor").hide()})),$(document).on("mouseenter mouseleave","a, ._btn, .nav_triger, .nav_triger li, .machine_active, input, #threeDModel, ._select, textarea, label",(function(e){"mouseenter"===e.type?$("#cursor").addClass("hover"):$("#cursor").removeClass("hover")})),$(document).on("mouseenter mouseleave",".machine_cards .machine_card",(function(e){"mouseenter"===e.type?$("#cursor").removeClass(a).find("span").text("swipe"):$("#cursor").addClass(a).find("span").text("scroll")})),moveElement($("#cursor-text"),$(".sweelin_watch")),$(".how_li_text span").each((function(){animateNumber($(this))})),$(document).on("blur","._input input:not([type=checkbox], [type=radio], [type=submit]), ._input textarea",(function(){input_fixed_placeholder($(this),$(this).siblings(".input_palceholder"))})),$(document).on("focus","._input input:not([type=checkbox], [type=radio], [type=submit]), ._input textarea",(function(){$(this).siblings(".input_palceholder").addClass(a)})),$(document).on("change keyup input",".form_input textarea",(function(){textarea_height($(this))})),$(document).on("focus",".form_input textarea",(function(){textarea_height($(this))})),$("._select select").length&&$("._select select").knotSelect(),$("#food-nav, #sugar-nav").hide()}$(":root").css("--scroll",scrollbar+"px");var timeout,dir=0;function vending(e,t,o){for(var a=[],s=[],n=0;n<=53;n++)name="Vending_"+n+".png",a.push(name),s.push($(`<img src="/images/vending/${name}">`));$(e).find(".vending_wrapper").append(s);var i=$("#vending-end").offset().top;$(e).find("img").hide().first().show(),t||(t=$(e).height()),o||(o=0),$(window).on("scroll",(function(){var s=$(this).scrollTop(),n=o+t;if(s>=o&&s<=n){var r=(s-o)/(n-o),c=Math.floor(r*a.length);c<=53&&$(e).find("img").hide().eq(c).show()}$(e).css("position",s>=i?"absolute":"fixed"),s>=i+1.3*$(window).height()?$("#text-rotate").css("position","absolute"):$("#text-rotate").css("position","fixed")}))}function sliderStart(){if($(".machine_cards").length)var e=new Swiper(".machine_cards",{effect:"cards",grabCursor:!0,initialSlide:1,cardsEffect:{perSlideOffset:180,perSlideRotate:6,slideShadows:!1}});if($(".machine .machine_active").length)var t=new Swiper(".machine .machine_active",{initialSlide:1,allowTouchMove:!1});e.on("slideChange",(function(){var o=e.activeIndex;t.slideTo(o)}))}function knotLax(){lax.init(),lax.addDriver("scrollY",(function(){return window.scrollY}));var e=$("#machine").offset().top;lax.addElements("#machine-active .machine_card span",{scrollY:{scale:[[e,e+200],["0","1"]]}}),lax.addElements("#machine-active .machine_card_name",{scrollY:{translateY:[[e+180,e+400],["-elHeight - 2","0"]]}}),lax.addElements("#machine-active .machine_card_img",{scrollY:{scale:[[e+350,e+550],["0","1"]],opacity:[[e+400,e+500],["0","1"]]}}),lax.addElements("#machine-cards",{scrollY:{scale:[[e+600,e+800],["0","1"]],opacity:[[e+650,e+750],["0","1"]]}}),lax.addElements("#text-rotate",{scrollY:{scale:[["screenHeight * .5","screenHeight * 1.4"],["0","1"]],opacity:[["screenHeight * .5","screenHeight * 1.4"],["0","1"]]}})}function cursorPosition(e,t){var o=e-$("#cursor").outerWidth()/2,a=t-$("#cursor").outerHeight()/2;$("#cursor").css({left:o+"px",top:a+"px"})}function cursorHover(e){(e=$(e)).mouseenter((function(t){var o=$(this).offset();e.find("span").css({top:t.pageY-o.top,left:t.pageX-o.left})})),e.mouseleave((function(t){var o=$(this).offset();e.find("span").css({top:t.pageY-o.top,left:t.pageX-o.left})}))}function scroll_to(e,t,o){if(!t)t=500;if(!o)o=0;0!=$(e).length&&$("html, body").animate({scrollTop:$(e).offset().top-o},t)}function open_card(e){if(0==load){var t=$(e).attr("data-object");threeD(t,e),sugar_count(t),$(".machine_cards_wrapper").css("pointer-events","none"),load++}}function sugar_count(e){url=`/${e}.html`,$.ajax({url:url,success:function(e){$("#sugar-content").html(e)}})}function open_card_load(e){load--;var t=(e=$(e)).find("picture").clone();e.attr("data-object");$("#card").show(),$("#card-img").html(t),$(".card_elips").addClass(a),$("#sugar-nav").removeClass("inactive"),$(".machine_cards_wrapper").css("pointer-events","visible"),$("#food-nav, #sugar-nav").show(),setTimeout((function(){cardLax(),scroll_to("#card-start",1e3)}),10),setTimeout((function(){card_scroll(),cardActive=1,sugarActive=1}),1e3)}function cardLax(){lax.addDriver("scrollY",(function(){return window.scrollY}));var e=$("#card-start").offset().top,t=$("#pink-start").offset().top,o=$(this).height();lax.addElements(".card_elips.active",{scrollY:{translateY:[[e-$(window).height(),e-$(window).height()/2],["0","screenHeight / 2"]],scale:[[e-$(window).height(),e-$(window).height()/2],["0","1"]]}}),lax.addElements("#card-machine",{scrollY:{translateY:[[0],["-elHeight / 2"]],translateX:[[0],["-elWidth / 2"]],scale:[[e-$(window).height(),e-$(window).height()/2],["1","3.2"]]}}),lax.addElements("#threeDModel",{scrollY:{scale:[[e-$(window).height(),e-$(window).height()/2],["0.3125","1"]]}}),lax.addElements(".card_sugar span",{scrollY:{scale:[[t+$(window).height(),t+1.5*$(window).height()],["0","57"]]}}),lax.addElements("#button",{scrollY:{scale:[[$("#sugar").offset().top-.2*o,$("#sugar").offset().top-.1*o,$("#sugar").offset().top,$("#sugar").offset().top+.2*o],["0","1","1","0"]],rotate:[[$("#sugar").offset().top-.2*o,$("#sugar").offset().top-.1*o,$("#sugar").offset().top,$("#sugar").offset().top+.2*o],["0","6","6","0"]],opacity:[[$("#sugar").offset().top-.2*o,$("#sugar").offset().top-.1*o,$("#sugar").offset().top,$("#sugar").offset().top+.2*o],["0","1","1","0"]]}})}function card_scroll(){$(window).scroll((function(){var e=$(this).height(),t=$(this).scrollTop();if(1==sugarActive){t>=$("#sugar-start").offset().top?$(".card_sugar").css({position:"fixed",top:0}):$(".card_sugar").css("position","static");var o=t/4,s=(t-$("#pink-start").offset().top)/o*18;pink_anim(s=Math.max(0,Math.min(s,18))),t>=$("#small-start").offset().top?$(".sugar_wrapper").css({position:"fixed",top:0}):$(".sugar_wrapper").css("position","relative"),t>=$("#sugar").offset().top-e/2?$("#sugar-nav").addClass(a):$("#sugar-nav").removeClass(a);var n=$("#small-start").offset().top+.1*e,i=n+.98*$("#small-start").height(),r=$("#small-start").find("img");if(t>=n&&t<=i){var c=(t-n)/(i-n),l=Math.floor(c*r.length);l<=r.length?$("#small-start").find("img").hide().eq(l).show():$("#small-start").find("img").hide()}else t<=n&&$("#small-start").find("img").hide();t>=$("#card").offset().top&&t<=$("#sugar").offset().top&&1==sweelinActive&&($("#sweelin").hide(),sweelinActive=0),t>=$("#small-start").offset().top&&t<=$("#sugar").offset().top+$("#sugar").height()-e?$(".sugar_wrapper").css({position:"fixed",top:0}):1==sweelinActiveStop&&$(".sugar_wrapper").css({position:"absolute",top:$("#sugar").offset().top-$("#small-start").offset().top+$("#sugar").height()-e}),t>=$("#card").offset().top&&t<=$("#sugar").offset().top?$("#threeDModel").css({position:"fixed",top:"calc(50% - var(--size)/ 2)"}):1==sweelinActiveStop&&$("#threeDModel").css({position:"absolute",top:$("#card-end").offset().top-e})}}))}function pink_anim(e){var t=$(".card_sugar p");t.css("text-shadow","");for(var o=0;o<2*Math.PI;o+=1/e)appendShadow(t,Math.cos(o)*e,Math.sin(o)*e,"#FF7BA3")}function appendShadow(e,t,o,a){var s="";"none"!==e.css("text-shadow")&&(s=e.css("text-shadow")+", "),s=s+t+"px "+o+"px "+a,e.css("text-shadow",s)}function nextSection(){$("#next-section").show(),$("html").css("overflow","hidden"),setTimeout((function(){sectionLax(),scroll_to("#next-section",2e3)}),10),$("#card_bg").css("background-color","var(--s1)"),$(".card_sugar").fadeOut(2e3),setTimeout((function(){section_scroll(),sweelin_open(),sectionActive=1,$("html").css("overflow","auto")}),2e3),setTimeout((function(){back=0}),500),$(window).scroll((function(){var e=$(this).scrollTop(),t=$("#sugar").offset().top,o=t+$("#sugar").height(),a=$("#small-start").find("img"),s=$("#old-index").val();if(e>=t&&e<=o){var n=(o-e)/(o-t),i=Math.floor(n*a.length);i>=s&&(console.log(i),$("#small-start").find("img").hide().eq(i).show())}}));var e=$("#percent");knotPercentIndex=Math.floor($("#percent").attr("data-index")),$(window).scroll((function(){var t=$(this).scrollTop(),o=$("#sugar").offset().top,a=o+$("#sugar").height(),s=knotPercentIndex;if(t>=o&&t<=a){var n=(a-t)/(a-o),i=s+Math.floor(n*(101-s));e.text(i+"%").fadeIn()}else t<=o&&e.fadeOut()}))}function backSection(){$("#next-section").hide(),$("#sweelin").hide(),$(".card_sugar").fadeIn(1e3),$("#sweelin").hide(),sweelinActive=0,sweelinActiveStop=0,sectionActive=0,setTimeout((function(){$("#card_bg").css("background-color","var(--s2)")}),1e3)}function section_scroll(){$(window).scroll((function(){var e=$(this).height(),t=$(this).scrollTop();1==sectionActive&&(t>=$("#card").offset().top&&t<=$("#next-section").offset().top-e&&0==back&&(backSection(),back=1),t>=$("#small-start").offset().top&&t<=$("#small-end").offset().top+$("#small-end").height()-e?$(".sugar_wrapper").css({position:"fixed",top:0}):$(".sugar_wrapper").css({position:"absolute",top:$("#small-end").offset().top-$("#small-start").offset().top+$("#small-end").height()-e}),t>=$("#card").offset().top&&t<=$("#card-end").offset().top-e?$("#threeDModel").css({position:"fixed",top:"calc(50% - var(--size)/ 2)"}):$("#threeDModel").css({position:"absolute",top:$("#card-end").offset().top-e}),t>=$("#card").offset().top&&t<=$("#card-end").offset().top-e?$(".card_rainbow").css({position:"fixed",top:"50%"}):$(".card_rainbow").css({position:"absolute",top:$(".card_wrapepr").height()-e/2}),t<=$("#sugar-end").offset().top?$("#sugar-nav").addClass(a):$("#sugar-nav").removeClass(a))}))}function sectionLax(){lax.addDriver("scrollY",(function(){return window.scrollY}));var e=$("#rainbow-start").offset().top;lax.addElements(".card_rainbow",{scrollY:{scale:[[e-$(window).height()/2,e],["0","1"]],rotate:[[0],["15.45"]],translateX:[[0],[$(".card_rainbow").width()/-2]],translateY:[[0],[$(".card_rainbow").height()/-2]]}})}function moveElement(e,t,o){var a=$(t),s=$(e);if(null==o)o=!0;a.mousemove((function(e){var t=e.pageX-a.offset().left-s.width()/2,n=e.pageY-a.offset().top-s.height()/2;e.pageX-a.offset().left<0||e.pageY-a.offset().top<0||e.pageX-a.offset().left>a.width()||e.pageY-a.offset().top>a.height()?o&&s.fadeOut():(s.fadeIn(),s.css({left:t+"px",top:n+"px"}))})).mouseleave((function(){o&&s.fadeOut()}))}function animateNumber(e){const t=new IntersectionObserver(o=>{o[0].isIntersecting&&setTimeout(()=>{const o=$(e).text(),a=parseFloat(o.replace(",",".")),s=Number.isInteger(a),n=o.includes(",")?",":".",i=s?0:o.split(n)[1].length;$({numberValue:0}).animate({numberValue:a},{duration:2e3,easing:"linear",step:function(t,o){const a=s?Math.ceil(t):t.toFixed(i);$(e).text(a.toString().replace(".",n))}}),t.disconnect()},$(e).attr("data-delay"))},{threshold:.1});t.observe($(e)[0])}function input_fixed_placeholder(e,t){var o=e,s=t;o.val().length>0?(s.addClass(a),o.addClass(a)):(s.removeClass(a),o.removeClass(a))}function textarea_height(e){var t=(e=$(e)).val().replace(/\r\n|\r|\n/g,"<br />&nbsp");e.siblings(".textarea_text").length||e.after($('<div class="textarea_text"></div>')),e.siblings(".textarea_text").html(t)}function nav_toggle(){var e=$(".nav_wrapper");e.find("ul").outerWidth(!0);e.toggleClass(a)}function nav_hide(){$(".nav_wrapper").removeClass(a)}function sweelin_open(e){$("#sweelin").show(),sweelinActiveStop=1,e&&setTimeout((function(){scroll_to(e)}),10),setTimeout((function(){sweelin_scroll(),sweelin_lax(),sweelinActive=1}),500)}function sweelin_scroll(){$(window).scroll((function(){var e=$(this).height(),t=$(this).scrollTop();1==sweelinActive&&(t>=$("#sweelin").offset().top-1&&$("#sugar-nav").removeClass(a),t>=$("#sweelin").offset().top-1&&t<=$("#sweelin-end").offset().top?$("#sweelin-nav").addClass(a):$("#sweelin-nav").removeClass(a),t>=$("#contact").offset().top-1&&t<=$("#contact-end").offset().top?$("#contact-nav").addClass(a):$("#contact-nav").removeClass(a),t>=$("#how").offset().top+.5*e?$("#how").addClass(a):$("#how").removeClass(a))}))}function sweelin_lax(){lax.addDriver("scrollY",(function(){return window.scrollY}));var e=$("#how").offset().top,t=$(this).height();lax.addElements(".how_sugar_spoon",{scrollY:{scale:[[e-t,e],[".7","1"]],rotate:[[e-t,e],["-40","0"]],translateX:[[e-t,e],["screenWidth * .32","0"]],translateY:[[0],["-elHeight / 2"]]}})}function threeD_close(){var e=document.getElementById("renderCanvas");e&&e.parentNode.removeChild(e)}function threeD(e,t){var o="threed/"+e+".glb",s=document.createElement("canvas");s.id="renderCanvas",document.getElementById("threeDModel").appendChild(s);var n=new BABYLON.Engine(s,!0),i=0,r=0,c=1,l=1,d=0;function f(e){if(e>d)var t=1;else t=-1;d=e;var o=p.getCameraByName("camera");o.alpha=.005*e,scrollPosCalc=r+(i*c+5e-4*e)*l;var a=.25*Math.PI,s=Math.PI/1.3;1==t?(s<=scrollPosCalc&&(r=s,i=5e-4*e,c=-1,l=-1),a>=scrollPosCalc&&(r=a,i=5e-4*e,c=-1,l=1)):(s<=scrollPosCalc&&(r=s,i=5e-4*e,l=-1,l=1),a>=scrollPosCalc&&(r=a,i=5e-4*e,c=-1,l=-1));var n=.05*(Math.max(a,Math.min(s,scrollPosCalc))-o.beta);o.beta+=n}var p=function(){var e=new BABYLON.Scene(n);e.clearColor=new BABYLON.Color4(0,0,0,0);var i=new BABYLON.ArcRotateCamera("camera",Math.PI/2+.12,Math.PI/2,2,BABYLON.Vector3.Zero(),e);i.lowerBetaLimit=null,i.upperBetaLimit=null,i.attachControl(s,!1,!1,!1),i.lowerRadiusLimit=i.upperRadiusLimit=2;var r=new BABYLON.HemisphericLight("oneLight",BABYLON.Vector3(0,0,0),e);r.intensity=.4;var c=new BABYLON.PointLight("twooLight",new BABYLON.Vector3(0,0,0),e);c.intensity=6e5,c.falloffType=BABYLON.Light.FALLOFF_PHYSICAL;var l=new BABYLON.PointLight("threeLight",new BABYLON.Vector3(0,0,0),e);return l.intensity=70,l.falloffType=BABYLON.Light.FALLOFF_PHYSICAL,e.registerBeforeRender((function(){i.position;r.direction._x=i.position._x,r.direction._y=i.position._y-8,r.direction._z=i.position._z,c.position._x=i.position._x+300,c.position._y=i.position._y+300,c.position._z=i.position._z,l.position._x=i.position._x-4,l.position._y=i.position._y-2,l.position._z=i.position._z})),BABYLON.SceneLoader.ImportMesh("","",o,e,(function(o){var s=new BABYLON.PBRMaterial("material",e);s.alpha=.5,s.transparencyMode=BABYLON.PBRMaterial.PBRMATERIAL_ALPHABLEND,s.reflectivityTexture=null,s.reflectivityColor=new BABYLON.Color3(0,0,0),o[0].material=s,o[0].scaling=new BABYLON.Vector3(2.5,2.5,-2.5),o[0].position=new BABYLON.Vector3(0,-.15,0),$("#card-machine").hide(),$("#threeDModel").addClass(a),open_card_load(t)})),e}();n.runRenderLoop((function(){p.render()})),window.addEventListener("resize",(function(){n.resize()})),window.addEventListener("scroll",(function(){f(window.pageYOffset||document.documentElement.scrollTop)}))}function decreaseNumber(e,t){$({number:100}).animate({number:e},{duration:t,easing:"linear",step:function(){var e=Math.floor(this.number);$("#element").text(e)},complete:function(){console.log("Анимация завершена!")}})}function preload_btn(e){var t=$(e),o=t.outerWidth(),a=t.outerHeight(),s=t.clone(!0);return t.replaceWith('<div class="__btn _load"></div>'),$(".__btn._load").outerWidth(o).outerHeight(a),s}function form_send(e){var t=preload_btn(e);$(".input_error").text("");var o=$("#name"),a=$("#email"),s=$("#message"),n=$("#updates"),i=$("#interested option:selected"),r=o.val(),c=a.val(),l=s.val(),d=n.is(":checked"),f=!1;"placeholder"!=i.val()&&(f=i.text()),$.ajax({type:"POST",url:"/apps/send.app.php",data:{name:r,email:c,message:l,updates:d,selected:f},success:function(e){var n=JSON.parse(e);console.log(n),1==n.process||(n.errs.name&&o.siblings(".input_error").text(n.errs.name),n.errs.email&&a.siblings(".input_error").text(n.errs.email),n.errs.message&&s.siblings(".input_error").text(n.errs.message)),$(".__btn._load").replaceWith(t)},error:function(e){console.log(e),$(".__btn._load").replaceWith(t)}})}$(window).scroll((function(){var e=$(this).height(),t=$(this).scrollTop();t<$("#card").offset().top&&1==cardActive&&($("#card").hide(),$("#sugar-nav").addClass("inactive"),$("#card-machine").show(),$("#food-nav, #sugar-nav").hide(),$("#threeDModel").removeClass(a),cardActive=0,sugarActive=0,threeD_close()),t<$("#food-end").offset().top-e&&1==sweelinActive&&($("#sweelin").hide(),sweelinActive=0),t>=$("#card-start").offset().top+100?0==card&&($("#card").addClass(a),$("#card_bg").css("background-color","var(--s2)"),card++):($("#card").removeClass(a),$("#card_bg").css("background-color","var(--s1)"),card=0),t>=e+100&&$("#nav").fadeIn(),t>=0&&t<=$("#home-end").offset().top?$("#home-nav").fadeOut():$("#home-nav").fadeIn(),t>=$("#food").offset().top-1.2*e&&t<=$("#food-end").offset().top-e/2?$("#food-nav").addClass(a):$("#food-nav").removeClass(a);t>=$(document).height()-e-50?$("#cursor").addClass(a):$("#cursor").removeClass(a)})),$("#nav").mouseenter((function(){clearTimeout(timeout)})),$("#nav").mouseleave((function(){timeout=setTimeout(nav_hide,3e3)}));